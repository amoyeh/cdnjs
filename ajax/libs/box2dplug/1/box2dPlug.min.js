var box2dp;!function(e){var t=function(){function e(){this.BACKGROUND=16053492,this.ITEM_STATIC=5592405,this.ITEM_DYNAMIC=8947848,this.ITEM_ALPHA=1,this.LINE_CENTER_X=16759218,this.LINE_CENTER_Y=12844978,this.LINE_BOUNDARY=12303291,this.PATH_LINE=9851040,this.PATH_LINEA=.4,this.PATH_FORCE=14579479,this.PATH_FORCEA=.4,this.SELECTION_LINE_SIZE=1,this.SELECTION_LINE_COLOR=15724527,this.SELECTION_LINE_ALPHA=.4,this.VELOCITY=16777215,this.VELOCITY_ALPHA=.6,this.ALIGNMENT=5276250,this.ALIGNMENT_ALPHA=.3,this.COHESION=5931650,this.COHESION_ALPHA=.3,this.SEPARATION=15093840,this.SEPARATION_ALPHA=.3,this.RAYCAST=16777215,this.RAYCAST_ALPHA=.1,this.AVOID_SHAPE=13395558,this.AVOID_SHAPE_ALPHA=1,this.GRID=6750207,this.GRID_ALPHA=.1,this.SENSOR=16768392,this.SENSOR_ALPHA=.3,this.BOUND=5622988,this.BOUND_ALPHA=.5,this.WANDER=9868950,this.WANDER_ALPHA=.3,this.QUADTREE=5622988,this.QUADTREE_A=.2}return e.DarkTheme=function(){var t=new e;return t.BACKGROUND=1579032,t.ITEM_STATIC=4802889,t.ITEM_DYNAMIC=8421504,t.ITEM_ALPHA=1,t.LINE_CENTER_X=16756121,t.LINE_CENTER_Y=11403161,t.LINE_BOUNDARY=7297135,t.PATH_LINE=9851040,t.PATH_LINEA=.4,t.PATH_FORCE=14579479,t.PATH_FORCEA=.4,t.SELECTION_LINE_SIZE=1,t.SELECTION_LINE_COLOR=15724527,t.SELECTION_LINE_ALPHA=.4,t.VELOCITY=16777215,t.VELOCITY_ALPHA=.6,t.ALIGNMENT=5276250,t.ALIGNMENT_ALPHA=.3,t.COHESION=5931650,t.COHESION_ALPHA=.3,t.SEPARATION=15093840,t.SEPARATION_ALPHA=.3,t.RAYCAST=16777215,t.RAYCAST_ALPHA=.1,t.AVOID_SHAPE=13395558,t.AVOID_SHAPE_ALPHA=1,t.GRID=6750207,t.GRID_ALPHA=.1,t.SENSOR=16768392,t.SENSOR_ALPHA=.3,t.BOUND=5622988,t.BOUND_ALPHA=.5,t.WANDER=9868950,t.WANDER_ALPHA=.3,t.QUADTREE=5622988,t.QUADTREE_A=.2,t},e.prototype.getItemStaticColor=function(){return this.ITEM_STATIC},e.prototype.getItemDynamicColor=function(){return this.ITEM_DYNAMIC},e.prototype.getItemStaticMat=function(){return this.itemStaticMat||(this.itemStaticMat=new THREE.MeshBasicMaterial({color:this.ITEM_STATIC,side:THREE.DoubleSide,opacity:this.ITEM_ALPHA,transparent:!0})),this.itemStaticMat},e.prototype.getItemDynamicMat=function(){return this.itemDynamicMat||(this.itemDynamicMat=new THREE.MeshBasicMaterial({color:this.ITEM_DYNAMIC,side:THREE.DoubleSide,opacity:this.ITEM_ALPHA,transparent:!0})),this.itemDynamicMat},e.prototype.getLineMatStatic=function(){return this.lineStaticMat||(this.lineStaticMat=new THREE.LineBasicMaterial({color:this.ITEM_STATIC,side:THREE.DoubleSide,opacity:this.ITEM_ALPHA,transparent:!0,linewidth:1})),this.lineStaticMat},e.prototype.getLineMatDynamic=function(){return this.lineDynamicMat||(this.lineDynamicMat=new THREE.LineBasicMaterial({color:this.ITEM_DYNAMIC,side:THREE.DoubleSide,opacity:this.ITEM_ALPHA,transparent:!0,linewidth:1})),this.lineDynamicMat},e.prototype.getSensorMat=function(){return this.sensorMat||(this.sensorMat=new THREE.MeshBasicMaterial({color:this.SENSOR,side:THREE.DoubleSide,opacity:this.SENSOR_ALPHA,transparent:!0})),this.sensorMat},e.prototype.getLineCenterXMat=function(){return this.lineCenterX||(this.lineCenterX=new THREE.LineBasicMaterial({color:this.LINE_CENTER_X})),this.lineCenterX},e.prototype.getLineCenterYMat=function(){return this.lineCenterY||(this.lineCenterY=new THREE.LineBasicMaterial({color:this.LINE_CENTER_Y})),this.lineCenterY},e.prototype.getLineBoundary=function(){return this.lineBoundary||(this.lineBoundary=new THREE.LineDashedMaterial({color:this.LINE_BOUNDARY,linewidth:2,dashSize:10,gapSize:5})),this.lineBoundary},e.prototype.getLineQuadTree=function(){return this.lineQuadTree||(this.lineQuadTree=new THREE.LineBasicMaterial({color:this.QUADTREE,side:THREE.DoubleSide,opacity:this.QUADTREE_A,transparent:!0})),this.lineQuadTree},e}();e.Color=t}(box2dp||(box2dp={}));var box2dp;!function(e){var t=function(){function e(e,t,i){this.type=e,t&&(this.target=t),i&&(this.values=i)}return e.prototype.toString=function(){return"[event] type: "+this.type+" target: "+this.target+" values: "+this.values},e.ITEM_CREATED="item_created",e.BEFORE_STEP="before_step",e.AFTER_STEP="after_step",e.BEFORE_RENDER="before_render",e.AFTER_RENDER="after_render",e.BEGIN_CONTACT="begin_contact",e.END_CONTACT="end_contact",e}();e.Event=t;var i=function(){function e(){this.callBacks=[]}return e.prototype.addEvent=function(e,t,i){null==this.callBacks[e]&&(this.callBacks[e]=[]),this.callBacks[e].push({func:t,caller:i})},e.prototype.removeEvent=function(e,t){if(null!=this.callBacks[e])for(var i=this.callBacks[e].length,r=0;i>r;r++)if(this.callBacks[e][r].func===t){this.callBacks[e].splice(r,1);break}},e.prototype.fireEvent=function(e){if(null!=this.callBacks[e.type])for(var t=this.callBacks[e.type].length,i=0;t>i;i++)this.callBacks[e.type][i].func(e,this.callBacks[e.type][i].caller)},e}();e.EventDispatcher=i}(box2dp||(box2dp={}));var __extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},box2dp;!function(e){var t=function(t){function r(o,n,s){void 0===s&&(s=r.UPDATE_FIXED),t.call(this),this.world=new box2d.b2World(new box2d.b2Vec2(o.x,o.y)),this.maker=new e.BoxMaker(this.world),this.physicFixStepTime=n,this.renderers=[],this.items=[],this.updateMode=s,this.groundBody=this.world.CreateBody(new box2d.b2BodyDef),this.contactManager=new i(this),this.world.SetContactListener(this.contactManager)}return __extends(r,t),r.addCounter=function(e){return null==r.uniqueNameCounters[e]&&(r.uniqueNameCounters[e]=0),r.uniqueNameCounters[e]++,r.uniqueNameCounters[e].toString(36)},r.prototype.setDebugDrawElements=function(e,t,i){this.debugDrawCanvas=document.getElementById(e),this.debugDrawCtx=this.debugDrawCanvas.getContext("2d"),this.debugDraw=new box2d.DebugDraw(this.debugDrawCanvas),this.debugDraw.SetFlags(box2d.b2DrawFlags.e_all),this.world.SetDebugDraw(this.debugDraw),this.debugDrawCanvas.width=t,this.debugDrawCanvas.height=i},r.prototype.addRenderer=function(e){this.renderers.push(e),e.domain=this,this.rlen=this.renderers.length},r.prototype.getUniqueName=function(e){for(var t=!1,i=0;i<this.items.length;i++)if(this.items[i].name==e){t=!0;break}if(t){for(var r="",o=1,n=!1,s=0;!n;){r=e+"-"+o;for(var a=!1,i=0;i<this.items.length;i++)if(this.items[i].name==r){o+=1,a=!0;break}if(s++,s>100)break;0==a&&(n=!0)}return r}return e},r.prototype.create=function(t){var i=t.name;i=null==t.name?"ItemEntity-"+r.addCounter("ItemEntity"):this.getUniqueName(i);var o=new e.ItemEntity(this.maker.create(t),t.itemType,i);this.items.push(o);for(var n=0;n<this.rlen;n++)this.renderers[n].onItemCreate(o);return this.fireEvent(new e.Event(e.Event.ITEM_CREATED,this,o)),o},r.prototype.step=function(){var t=this.items.length;if(this.quadTree){this.quadTree.clear();for(var i=0;t>i;i++){var o=this.quadTree.getItemSelector(this.items[i]);o&&(this.quadTree.insert(o),this.items[i].selector=o)}}for(var i=0;t>i;i++)this.items[i].integratePos(1),this.items[i].setOldPos();if(this.fireEvent(new e.Event(e.Event.BEFORE_STEP,this)),this.updateMode==r.UPDATE_FIXED)this.world.Step(this.physicFixStepTime,10,5,1);else if(this.lastStepTime){var n=Math.round(((new Date).getTime()-this.lastStepTime)/10)/100;this.world.Step(n,10,5,1)}this.debugDrawCtx&&(this.debugDrawCtx.clearRect(0,0,this.debugDrawCanvas.width,this.debugDrawCanvas.height),this.world.DrawDebugData());for(var i=0;t>i;i++)this.items[i].setCurrentPos(),this.items[i].updateBoundary();this.fireEvent(new e.Event(e.Event.AFTER_STEP,this)),this.lastStepTime=(new Date).getTime()},r.prototype.render=function(){var t,i=(new Date).getTime()-this.lastStepTime;if(isNaN(i)?t=1:(t=i/this.stepTime,t>1&&(t=1)),0!=t&&1!=t)for(var r=this.items.length,o=0;r>o;o++)this.items[o].integratePos(t);this.fireEvent(new e.Event(e.Event.BEFORE_RENDER,this,i));for(var n=0;n<this.rlen;n++)this.renderers[n].render();this.fireEvent(new e.Event(e.Event.AFTER_RENDER,this,i))},r.prototype.run=function(e,t){var i=this;this.stepTime=e,this.renderTime=t,this.stepInterval=setInterval(function(){i.step()},this.stepTime),this.renderInterval=setInterval(function(){i.render()},this.renderTime)},r.prototype.stop=function(){clearInterval(this.stepInterval),clearInterval(this.renderInterval)},r.prototype.updateInterval=function(e,t){var i=this;this.stop(),this.stepTime=e,this.renderTime=t,this.stepInterval=setInterval(function(){i.step()},this.stepTime),this.renderInterval=setInterval(function(){i.render()},this.renderTime)},r.prototype.setUpdateMode=function(e){this.updateMode=e},r.prototype.itemUnderPoint=function(e,t){var i=new QueryCallBack,r=new box2d.b2AABB;return r.lowerBound.Set(e,t),r.upperBound.Set(e+.001,t+.001),this.world.QueryAABB(i,r),i.itemList},r.prototype.eachItem=function(e){for(var t=this.items.concat(),i=t.length,r=i-1;r>-1;r--)e&&e(t[r],r)},r.prototype.removeItem=function(e){for(var t=0;t<this.rlen;t++)this.renderers[t].onItemRemove(e);for(var i=this.items.length,r=i-1;r>-1;r--)if(this.items[r]===e){this.items.splice(r,1);break}e.removePhysic(),e=null},r.UPDATE_FIXED=1,r.UPDATE_TIME_BASED=2,r.uniqueNameCounters={},r}(e.EventDispatcher);e.Domain=t;var i=function(){function t(e){this.domain=e,box2d.b2ContactListener.call(this)}return t.prototype.PreSolve=function(e,t){},t.prototype.PostSolve=function(e,t){},t.prototype.BeginContact=function(t){var i=t.GetFixtureA().GetBody().item,r=t.GetFixtureB().GetBody().item;i&&r&&(i.enableContactEvent&&i.fireEvent(new e.Event(e.Event.BEGIN_CONTACT,i,{otherItem:r})),r.enableContactEvent&&r.fireEvent(new e.Event(e.Event.BEGIN_CONTACT,r,{otherItem:i})))},t.prototype.EndContact=function(t){var i=t.GetFixtureA().GetBody().item,r=t.GetFixtureB().GetBody().item;i&&r&&(i.enableContactEvent&&i.fireEvent(new e.Event(e.Event.END_CONTACT,i,{otherItem:r})),r.enableContactEvent&&r.fireEvent(new e.Event(e.Event.END_CONTACT,r,{otherItem:i})))},t.prototype.BeginContactFixtureParticle=function(e,t){},t.prototype.EndContactFixtureParticle=function(e,t,i){},t.prototype.BeginContactParticleParticle=function(e,t){},t.prototype.EndContactParticleParticle=function(e,t,i){},t}()}(box2dp||(box2dp={}));var DestructionListener=function(){this.itemList=[],this.particleData=[]};window.goog.inherits(DestructionListener,box2d.b2DestructionListener),DestructionListener.prototype.SayGoodbyeJoint=function(e){},DestructionListener.prototype.SayGoodbyeFixture=function(e){},DestructionListener.prototype.SayGoodbyeParticleGroup=function(e){},DestructionListener.prototype.SayGoodbyeJoint=function(e){},DestructionListener.prototype.SayGoodbyeParticle=function(e,t){};var QueryCallBack=function(){this.itemList=[],this.particleData=[]};window.goog.inherits(QueryCallBack,box2d.b2QueryCallback),QueryCallBack.prototype.ReportFixture=function(e){return this.itemList.push(e),!0},QueryCallBack.prototype.ReportParticle=function(e,t){return this.particleData.push({index:t,system:e}),!0};var RayCastCallback=function(){box2d.b2RayCastCallback.call(this),this.itemList=[]};window.goog.inherits(RayCastCallback,box2d.b2RayCastCallback),RayCastCallback.prototype.ReportFixture=function(e,t,i,r){this.itemList.push({fixture:e,point:t.Clone(),normal:i.Clone(),fraction:r})};var box2dp;!function(e){var t=function(e){function t(t){e.call(this),this.name=t}return __extends(t,e),t.prototype.remove=function(){},t.SHAPE=1,t.SENSOR=2,t.UNIT=3,t.PATH=4,t}(e.EventDispatcher);e.ItemBase=t}(box2dp||(box2dp={}));var box2dp;!function(e){var t=function(t){function i(i,r,o){t.call(this,o),this.enableContactEvent=!1,this.type=r,this.b2body=i,this.b2body.item=this,this.setOldPos(),this.setCurrentPos(),this.updateBoundary(),this.display={},this.enableContactEvent=this.type==e.ItemBase.SENSOR}return __extends(i,t),i.prototype.setOldPos=function(){this.oldx=e.MakeInfo.mult30(this.b2body.GetPosition().x),this.oldy=e.MakeInfo.mult30(this.b2body.GetPosition().y),this.oldr=this.b2body.GetAngle()},i.prototype.setCurrentPos=function(){this.cx=e.MakeInfo.mult30(this.b2body.GetPosition().x),this.cy=e.MakeInfo.mult30(this.b2body.GetPosition().y),this.cr=this.b2body.GetAngle()},i.prototype.integratePos=function(e){this.ix=Math.round(this.oldx+(this.cx-this.oldx)*e),this.iy=Math.round(this.oldy+(this.cy-this.oldy)*e),this.ir=this.oldr+(this.cr-this.oldr)*e},i.prototype.getb2X=function(){return this.b2body.GetPosition().x},i.prototype.getb2Y=function(){return this.b2body.GetPosition().y},i.prototype.getPixelX=function(){return Math.round(30*this.b2body.GetPosition().x)},i.prototype.getPixelY=function(){return Math.round(30*this.b2body.GetPosition().y)},i.prototype.updateBoundary=function(){var t=new box2d.b2AABB;t.lowerBound=new box2d.b2Vec2(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),t.upperBound=new box2d.b2Vec2(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(var i=this.b2body.GetFixtureList();i;i=i.GetNext())for(var r=i.GetShape(),o=0;o<r.GetChildCount();o++)t.Combine1(i.GetAABB(o));var n=t.lowerBound.x,s=t.lowerBound.y,a=t.upperBound.x-t.lowerBound.x,h=t.upperBound.y-t.lowerBound.y;this.boundary={x:n,y:s,w:a,h:h},this.boundaryMult={x:e.MakeInfo.mult30(n),y:e.MakeInfo.mult30(s),w:e.MakeInfo.mult30(a),h:e.MakeInfo.mult30(h)}},i.prototype.getBoundary=function(t,i){var r=this.boundary;t&&(r=this.boundaryMult);var o={x:r.x,y:r.y,w:r.w,h:r.h};return i&&(t?(o.x-=e.MakeInfo.mult30(this.b2body.GetPosition().x),o.y-=e.MakeInfo.mult30(this.b2body.GetPosition().y)):(o.x-=this.b2body.GetPosition().x,o.y-=this.b2body.GetPosition().y)),o},i.prototype.setb2Position=function(e,t){this.b2body.SetPosition(new box2d.b2Vec2(e,t))},i.prototype.setPixelPosition=function(e,t){this.b2body.SetPosition(new box2d.b2Vec2(e/30,t/30))},i.prototype.setDynamic=function(e){this.b2body&&(this.b2body.GetType()===box2d.b2BodyType.b2_dynamicBody?this.b2body.SetType(box2d.b2BodyType.b2_staticBody):this.b2body.GetType()===box2d.b2BodyType.b2_staticBody&&this.b2body.SetType(box2d.b2BodyType.b2_dynamicBody),this.dynamic=e)},i.prototype.setCollisionMask=function(e){for(var t=this.b2body.GetFixtureList();null!=t;){var i=t.GetFilterData();i.maskBits=e,t.SetFilterData(i),t=t.GetNext()}},i.prototype.removePhysic=function(){this.b2body.SetUserData(void 0),this.b2body.GetWorld().DestroyBody(this.b2body),this.b2body.item=void 0,this.b2body=void 0,this.display=void 0},i}(e.ItemBase);e.ItemEntity=t}(box2dp||(box2dp={}));var box2dp;!function(e){var t=function(){function e(e,t,i,r,o,n,s){void 0===n&&(n=3),void 0===s&&(s=4),this.items=[],this.nodes=[],this.x=e,this.y=t,this.width=i,this.height=r,this.depth=o,this.maxChildren=n,this.maxDepth=s}return e.prototype.retrieve=function(e,t,i){for(var r=this,o=this.items.length,n=0;o>n;++n)i?t.call(i,this.items[n]):t(this.items[n]);this.nodes.length&&this.findOverlappingNodes(e,function(o){r.nodes[o].retrieve(e,t,i)})},e.prototype.findOverlappingNodes=function(t,i){t.x<this.x+this.width/2&&(t.y<this.y+this.height/2&&i(e.TOP_LEFT),t.y+t.height>=this.y+this.height/2&&i(e.BOTTOM_LEFT)),t.x+t.width>=this.x+this.width/2&&(t.y<this.y+this.height/2&&i(e.TOP_RIGHT),t.y+t.height>=this.y+this.height/2&&i(e.BOTTOM_RIGHT))},e.prototype.findInsertNode=function(t){return t.x+t.width<this.x+this.width/2?t.y+t.height<this.y+this.height/2?e.TOP_LEFT:t.y>=this.y+this.height/2?e.BOTTOM_LEFT:e.PARENT:t.x>=this.x+this.width/2?t.y+t.height<this.y+this.height/2?e.TOP_RIGHT:t.y>=this.y+this.height/2?e.BOTTOM_RIGHT:e.PARENT:e.PARENT},e.prototype.insert=function(t){var i;this.nodes.length>0?(i=this.findInsertNode(t),i===e.PARENT?(this.items.push(t),t.parent=this):(this.nodes[i].insert(t),t.parent=this.nodes[i])):(this.items.push(t),t.parent=this,this.items.length>this.maxChildren&&this.depth<this.maxDepth&&this.divide())},e.prototype.divide=function(){var t,i,r,o,n=this.depth+1;for(t=this.width/2,i=this.height/2,this.nodes.push(new e(this.x,this.y,t,i,n,this.maxChildren,this.maxDepth)),this.nodes.push(new e(this.x+t,this.y,t,i,n,this.maxChildren,this.maxDepth)),this.nodes.push(new e(this.x,this.y+i,t,i,n,this.maxChildren,this.maxDepth)),this.nodes.push(new e(this.x+t,this.y+i,t,i,n,this.maxChildren,this.maxDepth)),o=this.items,this.items=[],r=0;r<o.length;r++)this.insert(o[r])},e.prototype.clear=function(){for(var e=this.nodes.length;e--;)this.nodes[e].clear();this.items=[],this.nodes=[]},e.TOP_LEFT=0,e.TOP_RIGHT=1,e.BOTTOM_LEFT=2,e.BOTTOM_RIGHT=3,e.PARENT=4,e}();e.QuadNode=t;var i=function(){function e(e,t,i,r,o){this.x=e,this.y=t,this.width=i,this.height=r,this.data=o}return e.prototype.toString=function(){return"x:"+this.x+" y:"+this.y+" w: "+this.width+" h: "+this.height},e}();e.QuadSelector=i;var r=function(){function e(e,i,r,o,n,s){void 0===n&&(n=3),void 0===s&&(s=4),this.drawDebug=!1,this.rootNode=new t(e,i,r,o,0,n,s)}return e.prototype.insert=function(e){this.rootNode.insert(e)},e.prototype.retrieve=function(e,t,i){return this.rootNode.retrieve(e,t,i)},e.prototype.clear=function(){this.rootNode.clear()},e.prototype.getItemSelector=function(e){var t;if(null!=e.b2body){var r=e,o=r.getBoundary(!1,!1);t=new i(o.x,o.y,o.w,o.h,e)}return t},e.prototype.quadTreeSelect=function(e){var t=[],i=e.selector;return this.retrieve(i,function(i){i.data!=e&&t.push(i)}),t.length>0?t:null},e}();e.QuadTree=r}(box2dp||(box2dp={}));var box2dp;!function(e){var t=function(){function t(e){this.world=e}return t.prototype.create=function(t){if(null==t.createType)return void console.error("createType not defined");var i=t.clone(),r=this.createbody(t);switch(t.createType){case e.MakeInfo.MAKE_BOX_TOP_LEFT:case e.MakeInfo.MAKE_BOX_CENTER:this.createBoxDef(r,i);break;case e.MakeInfo.MAKE_CIRCLE:this.createCircleDef(r,i);break;case e.MakeInfo.MAKE_POLYGON:this.createPolygonDef(r,i);break;case e.MakeInfo.MAKE_EDGE:this.createEdge(r,i);break;case e.MakeInfo.MAKE_COMPOUND:for(var o=0;o<i.makeInfos.length;o++)switch(i.makeInfos[o].createType){case e.MakeInfo.MAKE_BOX_TOP_LEFT:case e.MakeInfo.MAKE_BOX_CENTER:var n=i.makeInfos[o].clone(),s=this.createBoxDef(r,n,n.x,n.y);n.fixtureData&&(s.fixtureData=n.fixtureData);break;case e.MakeInfo.MAKE_CIRCLE:var n=i.makeInfos[o].clone(),s=this.createCircleDef(r,n,n.x,n.y);n.fixtureData&&(s.fixtureData=n.fixtureData);break;case e.MakeInfo.MAKE_POLYGON:var n=i.makeInfos[o].clone(!0),s=this.createPolygonDef(r,n);n.fixtureData&&(s.fixtureData=n.fixtureData);break;case e.MakeInfo.MAKE_EDGE:var n=i.makeInfos[o].clone(!0),a=this.createEdge(r,n);if(n.fixtureData)for(var h=0;h<a.length;h++)a[h].fixtureData=n.fixtureData}}return i.userData&&r.SetUserData(i.userData),r.SetPositionXY(i.x,i.y),r},t.prototype.createEdge=function(e,t){var i=this.createFixtureDef(t),r=new box2d.b2EdgeShape,o=[];if(2==t.b2Vertices.length)r.SetAsEdge(t.b2Vertices[0],t.b2Vertices[1]),i.shape=r,o.push(e.CreateFixture(i));else if(t.loopEdge){r.SetAsEdge(t.b2Vertices[0],t.b2Vertices[1]),r.m_hasVertex0=!0,r.m_vertex3.Copy(t.b2Vertices[t.b2Vertices.length-1]),r.m_hasVertex3=!0,r.m_vertex3.Copy(t.b2Vertices[2]),i.shape=r,o.push(e.CreateFixture(i));for(var n=1;n<t.b2Vertices.length;n++){var s=t.b2Vertices[n],a=t.b2Vertices[n+1];null==a&&(a=t.b2Vertices[0]),r.SetAsEdge(s,a),t.b2Vertices[n-1]&&(r.m_hasVertex0=!0,r.m_vertex0.Copy(t.b2Vertices[n-1]));var h=t.b2Vertices[n+2];null==h&&(h=t.b2Vertices[(n+2)%t.b2Vertices.length]),r.m_hasVertex3=!0,r.m_vertex3.Copy(h),i.shape=r,o.push(e.CreateFixture(i))}}else{r.SetAsEdge(t.b2Vertices[0],t.b2Vertices[1]),r.m_hasVertex3=!0,r.m_vertex3.Copy(t.b2Vertices[2]),i.shape=r,o.push(e.CreateFixture(i));for(var n=1;n<t.b2Vertices.length-1;n++){var s=t.b2Vertices[n],a=t.b2Vertices[n+1];r.SetAsEdge(s,a),t.b2Vertices[n-1]&&(r.m_hasVertex0=!0,r.m_vertex0.Copy(t.b2Vertices[n-1])),t.b2Vertices[n+2]&&(r.m_hasVertex3=!0,r.m_vertex3.Copy(t.b2Vertices[n+2])),i.shape=r,o.push(e.CreateFixture(i))}}return o},t.prototype.createBoxDef=function(t,i,r,o){void 0===r&&(r=0),void 0===o&&(o=0);var n=this.createFixtureDef(i),s=new box2d.b2PolygonShape,a=new box2d.b2Vec2(r,o);return i.createType==e.MakeInfo.MAKE_BOX_TOP_LEFT&&(a.x+=.5*i.w,a.y+=.5*i.h),s.SetAsBox(.5*i.w,.5*i.h,a),n.shape=s,t.CreateFixture(n)},t.prototype.createCircleDef=function(e,t,i,r){void 0===i&&(i=0),void 0===r&&(r=0);var o=this.createFixtureDef(t),n=new box2d.b2CircleShape;return n.m_radius=t.radius,n.m_p.Set(i,r),o.shape=n,e.CreateFixture(o)},t.prototype.createPolygonDef=function(e,t){var i=this.createFixtureDef(t),r=new box2d.b2PolygonShape;return r.Set(t.b2Vertices),i.shape=r,e.CreateFixture(i)},t.prototype.createFixtureDef=function(e){var t=new box2d.b2FixtureDef;return t.density=e.density,t.friction=e.friction,t.restitution=e.restitution,t.isSensor=e.isSensor,e.maskBits&&(t.filter.maskBits=e.maskBits),e.categoryBits&&(t.filter.categoryBits=e.categoryBits),t},t.prototype.createbody=function(e){var t=new box2d.b2BodyDef;t.type=box2d.b2BodyType.b2_dynamicBody,t.allowSleep=e.allowSleep,t.fixedRotation=e.fixedRotation,e.angle&&(t.angle=e.angle),e.isStatic&&(t.type=box2d.b2BodyType.b2_staticBody),1==e.bullet&&(t.bullet=!0);var i=this.world.CreateBody(t);return i},t.prototype.createChain=function(t){var i=.0174533*t.degree;t.overLapGap||(t.overLapGap=5),t.pinHead||(t.pinHead=!1),t.pinTail||(t.pinTail=!1),t.collideConnected||(t.collideConnected=!1),t.density||(t.density=1);var r=new box2d.b2RevoluteJointDef;r.collideConnected=t.collideConnected;var o,n,s,a=new e.MakeInfo({w:t.h,h:t.w,angle:i,createType:e.MakeInfo.MAKE_BOX_CENTER,density:t.density}),h={};h.bodies=[],h.revoulteJoints=[];for(var d=0;d<t.amt;d++){var c=Math.cos(i)*(t.h-t.overLapGap),l=Math.sin(i)*(t.h-t.overLapGap);a.x=t.x+c*d,a.y=t.y+l*d;var p=this.create(a);if(h.bodies.push(p),0==d&&(n=p),d==t.amt-1&&(s=p),o){var u=p.GetPosition().Clone();u.x-=Math.cos(i)*t.h/60,u.y-=Math.sin(i)*t.h/60,r.Initialize(o,p,u),this.world.CreateJoint(r),h.revoulteJoints.push(this.world.CreateJoint(r))}o=p}var y=new box2d.b2RopeJointDef;if(y.bodyA=n,y.localAnchorA=new box2d.b2Vec2(0,0),y.localAnchorB=new box2d.b2Vec2(0,0),y.maxLength=e.MakeInfo.round((t.h-t.overLapGap)*t.amt/30),y.bodyB=s,h.ropeJoint=this.world.CreateJoint(y),t.pinHead){var m=new e.MakeInfo({x:t.x,y:t.y,radius:4,createType:e.MakeInfo.MAKE_CIRCLE,isStatic:!0}),E=this.create(m);r.Initialize(E,n,E.GetPosition().Clone()),h.headPin=E,h.headJoint=this.world.CreateJoint(r)}if(t.pinTail){var f=30*s.GetPosition().x,v=30*s.GetPosition().y,m=new e.MakeInfo({x:f,y:v,radius:4,createType:e.MakeInfo.MAKE_CIRCLE,isStatic:!0}),b=this.create(m);r.Initialize(b,s,b.GetPosition().Clone()),this.world.CreateJoint(r),h.tailPin=b,h.tailJoint=this.world.CreateJoint(r)}return h},t}();e.BoxMaker=t}(box2dp||(box2dp={}));var box2dp;!function(e){var t=function(){function e(e){this.x=0,this.y=0,this.w=0,this.h=0,this.radius=0,this.allowSleep=!0,this.isStatic=!1,this.density=1,this.friction=.2,this.restitution=0,this.fixedRotation=!1,this.loopEdge=!1,this.isSensor=!1;for(var t in e)this[t]=e[t]}return e.round=function(e){return Math.round(1e3*e)/1e3},e.random=function(t,i,r){void 0===r&&(r=!0);var o=Math.random()*(i-t)+t;return r&&(o=e.round(o)),o},e.div30=function(t){return e.round(t/30)},e.mult30=function(e){return Math.round(30*e)},e.getb2Vec2=function(t){if(this.usePixelScale){var i=e.round(t.x/30),r=e.round(t.y/30);return new box2d.b2Vec2(i,r)}return t},e.prototype.clone=function(t){void 0===t&&(t=!1);var i=new e(null);for(var r in this)("number"==typeof this[r]||"boolean"==typeof this[r]||"string"==typeof this[r])&&(i[r]=this[r]);this.makeInfos&&(i.makeInfos=this.makeInfos),this.userData&&(i.userData=this.userData),this.fixtureData&&(i.fixtureData=this.fixtureData);var o=0,n=0;if(t&&(o+=this.x),t&&(n+=this.y),this.vertices){i.vertices=[],i.b2Vertices=[];for(var s=0;s<this.vertices.length;s++)i.vertices.push({x:this.vertices[s].x+o,y:this.vertices[s].y+n}),i.b2Vertices.push(new box2d.b2Vec2(this.vertices[s].x+o,this.vertices[s].y+n))}var a=["x","y","w","h","radius"],h=["vertices","b2Vertices"];if(e.usePixelScale)for(var r in i)if(a.indexOf(r)>-1&&(i[r]=e.div30(i[r])),h.indexOf(r)>-1)for(var s=0;s<i[r].length;s++)i[r][s].x=e.div30(i[r][s].x),i[r][s].y=e.div30(i[r][s].y);return i},e.ONED=Math.PI/180,e.usePixelScale=!0,e.MAKE_BOX_TOP_LEFT=1,e.MAKE_BOX_CENTER=2,e.MAKE_POLYGON=3,e.MAKE_CIRCLE=4,e.MAKE_EDGE=5,e.MAKE_COMPOUND=6,e}();e.MakeInfo=t}(box2dp||(box2dp={}));var box2dp;!function(e){var t=function(){function t(i){this.drawFlags=t.DRAW_SHAPE,null==i.width&&(i.width=900),null==i.height&&(i.height=600),null==i.antialias&&(i.antialias=!0),null==i.invertY&&(i.invertY=!0),null==i.elementId||null==document.getElementById(i.elementId)?this.useElement=document.body:this.useElement=document.getElementById(i.elementId),i.dragFlags&&(this.drawFlags=i.dragFlags),null==i.colorClass?this.colorClass=new e.Color:this.colorClass=i.colorClass,this.options=i}return t.prototype.hasDrawType=function(e){return(this.drawFlags&e)==e},t.prototype.beforeStep=function(){},t.prototype.afterStep=function(){},t.prototype.render=function(){},t.prototype.onItemCreate=function(e){},t.prototype.onItemRemove=function(e){},t.DRAW_SHAPE=2,t.DRAW_CENTER=4,t.DRAW_BOUNDARY=8,t.DRAW_QUAD_TREE=16,t}();e.BaseRenderer=t}(box2dp||(box2dp={}));var box2dp;!function(e){var t=function(){function t(e){this.domain=e.domain,this.world=this.domain.world,this.renderer=e}return t.prototype.createDragDrop=function(){"PixiRenderer"==this.renderer.constructor.name&&this.createPixiDragDrop(),"ThreeRenderer"==this.renderer.constructor.name&&this.createThreeDragDrop()},t.prototype.removeDragDrop=function(){this.renderer.useElement.removeEventListener("mousedown",this.mousedownObj),document.removeEventListener("mousemove",this.mouseMoveObj),document.removeEventListener("mouseup",this.mouseUpObj)},t.prototype.createPixiDragDrop=function(){var e=this;this.renderer.useElement.addEventListener("mousedown",this.mousedownObj=function(t){e.ddPress(t)})},t.prototype.ddPress=function(t){var i=this,r=e.MakeInfo.round((t.pageX-this.renderer.useElement.offsetLeft)/30),o=e.MakeInfo.round((t.pageY-this.renderer.useElement.offsetTop)/30),n=this.domain.itemUnderPoint(r,o);if(n.length>0){var s=n[0].GetBody(),a=new box2d.b2MouseJointDef;a.bodyA=this.domain.groundBody,a.bodyB=s,a.target.Copy(new box2d.b2Vec2(r,o)),a.maxForce=1e3*s.GetMass(),this.mouseJoint=this.domain.world.CreateJoint(a),s.SetAwake(!0)}document.addEventListener("mousemove",this.mouseMoveObj=function(e){i.ddMove(e)}),document.addEventListener("mouseup",this.mouseUpObj=function(e){i.ddUp(e)})},t.prototype.ddMove=function(t){var i=e.MakeInfo.round((t.pageX-this.renderer.useElement.offsetLeft)/30),r=e.MakeInfo.round((t.pageY-this.renderer.useElement.offsetTop)/30);this.mouseJoint&&this.mouseJoint.SetTarget(new box2d.b2Vec2(i,r))},t.prototype.ddUp=function(e){this.mouseJoint&&(this.domain.world.DestroyJoint(this.mouseJoint),this.mouseJoint=null),document.removeEventListener("mousemove",this.mouseMoveObj),document.removeEventListener("mouseup",this.mouseUpObj)},t.prototype.tjPress=function(t){var i=this,r=t.pageX-this.renderer.useElement.offsetLeft,o=t.pageY-this.renderer.useElement.offsetTop,n=this.renderer.getXYFromCamera(r,o),s=e.MakeInfo.round(n.x/30),a=e.MakeInfo.round(n.y/30),h=this.domain.itemUnderPoint(s,a);if(h.length>0){var d=h[0].GetBody(),c=new box2d.b2MouseJointDef;c.bodyA=this.domain.groundBody,c.bodyB=d,c.target.Copy(new box2d.b2Vec2(s,a)),c.maxForce=1e3*d.GetMass(),this.mouseJoint=this.domain.world.CreateJoint(c),d.SetAwake(!0),console.log(d)}document.addEventListener("mousemove",this.mouseMoveObj=function(e){i.tjMove(e)}),document.addEventListener("mouseup",this.mouseUpObj=function(e){i.tjUp(e)})},t.prototype.createThreeDragDrop=function(){var e=this;this.renderer.useElement.addEventListener("mousedown",this.mousedownObj=function(t){e.tjPress(t)})},t.prototype.tjMove=function(t){var i=t.pageX-this.renderer.useElement.offsetLeft,r=t.pageY-this.renderer.useElement.offsetTop,o=this.renderer.getXYFromCamera(i,r),n=e.MakeInfo.round(o.x/30),s=e.MakeInfo.round(o.y/30);this.mouseJoint&&this.mouseJoint.SetTarget(new box2d.b2Vec2(n,s))},t.prototype.tjUp=function(e){this.mouseJoint&&(this.domain.world.DestroyJoint(this.mouseJoint),this.mouseJoint=null),document.removeEventListener("mousemove",this.mouseMoveObj),document.removeEventListener("mouseup",this.mouseUpObj)},t.prototype.trackCtrlUpdate=function(e,t){t.trackCtrl.update(50*e.values)},t.prototype.createTrackBallCtrl=function(){var t=this.renderer;t.camera.position.x=0,t.camera.position.y=0,this.trackCtrl=new THREE.TrackballControls(t.camera,t.useElement),this.trackCtrl.rotateSpeed=2,this.trackCtrl.zoomSpeed=2,this.trackCtrl.panSpeed=2,this.trackCtrl.dynamicDampingFactor=.3,this.trackCtrl.staticMoving=!0;var i=new THREE.Vector3(.5*t.options.width,.5*-t.options.height,0);this.trackCtrl.object.position.add(i),this.trackCtrl.target.add(i),this.domain.addEvent(e.Event.AFTER_RENDER,this.trackCtrlUpdate,this)},t.prototype.removeTrackBallCtrl=function(){this.domain.removeEvent(e.Event.AFTER_RENDER,this.trackCtrlUpdate),this.trackCtrl&&(this.trackCtrl.enabled=!1,this.trackCtrl=void 0)},t.prototype.orbitCtrlUpdate=function(e,t){t.orbCtrl.update()},t.prototype.createOrbitCtrl=function(){var t=this.renderer;this.orbCtrl=new THREE.OrbitControls(t.camera,t.useElement),this.orbCtrl.enableDamping=!0,this.orbCtrl.dampingFactor=.2;var i=new THREE.Vector3(.5*t.options.width,.5*-t.options.height,0);this.orbCtrl.target=i,this.domain.addEvent(e.Event.AFTER_RENDER,this.orbitCtrlUpdate,this)},t.prototype.removeOrbitCtrl=function(){this.domain.removeEvent(e.Event.AFTER_RENDER,this.orbitCtrlUpdate),this.orbCtrl&&(console.log(this.orbCtrl),this.orbCtrl.enabled=!1,this.orbCtrl=void 0,console.log(this.orbCtrl))},t}();e.DragControl=t}(box2dp||(box2dp={}));var box2dp;!function(e){var t=function(t){function i(e){t.call(this,e);var i={antialias:e.antialias,transparent:e.transparent};0==e.transparent&&e.backgroundColor&&(i.backgroundColor=e.backgroundColor),this.renderer=PIXI.autoDetectRenderer(e.width,e.height,i),this.renderer.backgroundColor=this.colorClass.BACKGROUND,this.useElement.appendChild(this.renderer.view),this.scene=new PIXI.Container,this.container=new PIXI.Container,this.scene.addChild(this.container),this.quadGraphic=new PIXI.Graphics,this.scene.addChild(this.quadGraphic),this.overGraphic=new PIXI.Graphics,this.scene.addChild(this.overGraphic)}return __extends(i,t),i.prototype.beforeStep=function(){},i.prototype.afterStep=function(){},i.prototype.render=function(){for(var t=this.domain.items.length,i=0;t>i;i++){var r=this.domain.items[i];r.display.pixi&&this.itemDisplayUpdate(r.display.pixi,r)}this.hasDrawType(e.BaseRenderer.DRAW_QUAD_TREE)&&null!=this.domain.quadTree&&(this.quadGraphic.visible=!0,this.quadGraphic.clear(),this.domain.quadTree.rootNode&&this.drawTreeNode(this.domain.quadTree.rootNode)),this.hasDrawType(e.BaseRenderer.DRAW_QUAD_TREE)||(this.quadGraphic.clear(),this.quadGraphic.visible=!1),this.renderer.render(this.scene)},i.prototype.drawTreeNode=function(t){if(t.nodes.length>0)for(var i=0;i<t.nodes.length;i++)this.drawTreeNode(t.nodes[i]);var r=this.quadGraphic;r.lineStyle(2,this.colorClass.QUADTREE,this.colorClass.QUADTREE_A),r.drawRect(e.MakeInfo.mult30(t.x),e.MakeInfo.mult30(t.y),e.MakeInfo.mult30(t.width),e.MakeInfo.mult30(t.height))},i.prototype.onItemCreate=function(t){var i=t,r=new PIXI.Container,o=new PIXI.Graphics;o.name="shape";var n=new PIXI.Graphics;n.name="center";var s=new PIXI.Graphics;s.name="boundary",r.addChild(o),o.addChild(n),r.addChild(s),i.display.pixi=r,this.container.addChild(r);var a=i.b2body.GetFixtureList(),h=this.colorClass.ITEM_STATIC,d=this.colorClass.ITEM_ALPHA;for(i.b2body.GetType()==box2d.b2BodyType.b2_dynamicBody&&(h=this.colorClass.ITEM_DYNAMIC),t.type==e.ItemBase.SENSOR&&(h=this.colorClass.SENSOR,d=this.colorClass.SENSOR_ALPHA);null!=a;){switch(a.GetType()){case box2d.b2ShapeType.e_circleShape:var c=a.GetShape(),l=e.MakeInfo.mult30(c.m_radius);o.lineWidth=0,o.beginFill(h,d);var p=e.MakeInfo.mult30(c.m_p.x),u=e.MakeInfo.mult30(c.m_p.y);o.drawCircle(p,u,l),o.endFill();break;case box2d.b2ShapeType.e_polygonShape:var y=a.GetShape();o.lineWidth=0,o.beginFill(h,d);var m=e.MakeInfo.mult30(y.m_vertices[0].x),E=e.MakeInfo.mult30(y.m_vertices[0].y);
o.moveTo(m,E);for(var f=0;f<y.m_count;f++){var v=e.MakeInfo.mult30(y.m_vertices[f].x),b=e.MakeInfo.mult30(y.m_vertices[f].y);o.lineTo(v,b)}o.lineTo(m,E),o.endFill();break;case box2d.b2ShapeType.e_edgeShape:var T=a.GetShape();o.lineStyle(1,h,d),o.lineWidth=2;var x=e.MakeInfo.mult30(T.m_vertex1.x),C=e.MakeInfo.mult30(T.m_vertex1.y),I=e.MakeInfo.mult30(T.m_vertex2.x),w=e.MakeInfo.mult30(T.m_vertex2.y);o.moveTo(x,C),o.lineTo(I,w)}a=a.GetNext()}var _=e.MakeInfo.mult30(i.b2body.GetLocalCenter().x),g=e.MakeInfo.mult30(i.b2body.GetLocalCenter().y);n.moveTo(_,g),n.lineStyle(1,16756121,1),n.lineTo(_+8,g),n.moveTo(_,g),n.lineStyle(1,11403161,1),n.lineTo(_,g+8);var D=t.getBoundary(!0,!0);s.lineStyle(1,7297135,1),this.dashLine(s,D.x,D.y,D.x+D.w,D.y),this.dashLine(s,D.x,D.y+D.h,D.x+D.w,D.y+D.h),this.dashLine(s,D.x,D.y,D.x,D.y+D.h),this.dashLine(s,D.x+D.w,D.y,D.x+D.w,D.y+D.h),this.itemDisplayUpdate(r,i)},i.prototype.onItemRemove=function(e){e.display&&e.display.pixi&&(this.container.removeChild(e.display.pixi),e.display.pixi.destroy(!0),delete e.display.pixi)},i.prototype.itemDisplayUpdate=function(t,i){t.x=i.ix,t.y=i.iy,t.getChildByName("shape").rotation=i.ir,t.getChildByName("shape").visible=this.hasDrawType(e.BaseRenderer.DRAW_SHAPE),t.getChildByName("shape").getChildByName("center").visible=this.hasDrawType(e.BaseRenderer.DRAW_CENTER),t.getChildByName("boundary").visible=this.hasDrawType(e.BaseRenderer.DRAW_BOUNDARY);var r=t.getChildByName("boundary");r.clear();var o=i.getBoundary(!0,!0);r.lineStyle(1,7297135,1),this.dashLine(r,o.x,o.y,o.x+o.w,o.y),this.dashLine(r,o.x,o.y+o.h,o.x+o.w,o.y+o.h),this.dashLine(r,o.x,o.y,o.x,o.y+o.h),this.dashLine(r,o.x+o.w,o.y,o.x+o.w,o.y+o.h)},i.prototype.dashLine=function(e,t,i,r,o,n){n||(n=[10,5]);var s=n.length;e.moveTo(t,i);for(var a=r-t,h=o-i,d=a?h/a:1e15,c=Math.sqrt(a*a+h*h),l=0,p=!0;c>=.1;){var u=n[l++%s];u>c&&(u=c);var y=Math.sqrt(u*u/(1+d*d));0>a&&(y=-y),t+=y,i+=d*y,p?e.lineTo(t,i):e.moveTo(t,i),c-=u,p=!p}},i}(e.BaseRenderer);e.PixiRenderer=t}(box2dp||(box2dp={}));var box2dp;!function(e){var t=function(t){function i(e){t.call(this,e),this.camera=new THREE.PerspectiveCamera(45,e.width/e.height,1,1e4);var i=45,r=i*(Math.PI/180);this.camera.position.z=e.height/(2*Math.tan(r/2)),this.camera.lookAt(new THREE.Vector3(0,0,0)),this.renderer=new THREE.WebGLRenderer({antialias:e.antialias}),this.renderer.setSize(e.width,e.height),this.renderer.setClearColor(this.colorClass.BACKGROUND,1),this.useElement.appendChild(this.renderer.domElement),this.scene=new THREE.Scene,this.container=new THREE.Object3D,this.scene.add(this.container),this.quadGraphic=new THREE.Object3D,this.overGraphic=new THREE.Object3D,this.scene.add(this.quadGraphic),this.scene.add(this.overGraphic),this.renderer.render(this.scene,this.camera),e.invertY&&this.invertYSetup()}return __extends(i,t),i.prototype.invertYSetup=function(){this.container.scale.set(1,-1,1),this.quadGraphic.scale.set(1,-1,1),this.overGraphic.scale.set(1,-1,1),this.camera.position.x=.5*this.options.width,this.camera.position.y=this.options.height*-.5},i.prototype.beforeStep=function(){},i.prototype.afterStep=function(){},i.prototype.render=function(){for(var t=this.domain.items.length,i=0;t>i;i++){var r=this.domain.items[i];r.display.three&&this.itemDisplayUpdate(r.display.three,r)}this.hasDrawType(e.BaseRenderer.DRAW_QUAD_TREE)&&null!=this.domain.quadTree&&(this.quadGraphic.visible=!0,this.clearQuadTreeGuide(),this.domain.quadTree.rootNode&&this.drawTreeNode(this.domain.quadTree.rootNode)),this.hasDrawType(e.BaseRenderer.DRAW_QUAD_TREE)||(this.quadGraphic.visible=!1),this.renderer.render(this.scene,this.camera)},i.prototype.drawTreeNode=function(t){if(t.nodes.length>0)for(var i=0;i<t.nodes.length;i++)this.drawTreeNode(t.nodes[i]);var r=e.MakeInfo.mult30(t.x),o=e.MakeInfo.mult30(t.y),n=e.MakeInfo.mult30(t.width),s=e.MakeInfo.mult30(t.height),a=new THREE.Geometry;a.vertices.push(new THREE.Vector3(r,o,0),new THREE.Vector3(r+n,o,0),new THREE.Vector3(r+n,o+s,0),new THREE.Vector3(r,o+s,0),new THREE.Vector3(r,o,0));var h=new THREE.Line(a,this.colorClass.getLineQuadTree(),THREE.LineStrip);this.quadGraphic.add(h)},i.prototype.clearQuadTreeGuide=function(){for(var e=this.quadGraphic.children.length-1;e>-1;e--){var t=this.quadGraphic.children[e];this.quadGraphic.remove(t),t.geometry.dispose(),t.geometry=void 0}},i.prototype.clearOverShapes=function(){for(var e=this.overGraphic.children.length-1;e>-1;e--){var t=this.overGraphic.children[e];this.overGraphic.remove(t),t.geometry&&(t.geometry.dispose(),t.geometry=void 0),t.material&&(t.material.dispose(),t.material=void 0)}},i.prototype.onItemCreate=function(t){var i=t,r=new THREE.Object3D;r.name=t.name;var o=new THREE.Object3D;o.name="shape";var n=new THREE.Object3D;n.position.z=.1,n.name="center";var s=new THREE.Object3D;s.name="boundary",s.position.z=.2,r.add(o),o.add(n),r.add(s),i.display.three=r,this.container.add(r);var a=i.b2body.GetFixtureList(),h=this.colorClass.getItemStaticMat();i.b2body.GetType()==box2d.b2BodyType.b2_dynamicBody&&(h=this.colorClass.getItemDynamicMat()),t.type==e.ItemBase.SENSOR&&(h=this.colorClass.getSensorMat());var d=this.colorClass.getLineMatStatic();for(i.b2body.GetType()==box2d.b2BodyType.b2_dynamicBody&&(d=this.colorClass.getLineMatDynamic());null!=a;){switch(a.GetType()){case box2d.b2ShapeType.e_circleShape:var c=a.GetShape(),l=e.MakeInfo.mult30(c.m_radius),p=new THREE.CircleGeometry(l,24),u=new THREE.Mesh(p,h);u.name="circleMesh";var y=e.MakeInfo.mult30(c.m_p.x),m=e.MakeInfo.mult30(c.m_p.y);u.position.set(y,m,0),o.add(u);break;case box2d.b2ShapeType.e_polygonShape:var E=new THREE.Shape,f=a.GetShape(),v=e.MakeInfo.mult30(f.m_vertices[0].x),b=e.MakeInfo.mult30(f.m_vertices[0].y);E.moveTo(v,b);for(var T=1;T<f.m_count;T++){var x=e.MakeInfo.mult30(f.m_vertices[T].x),C=e.MakeInfo.mult30(f.m_vertices[T].y);E.lineTo(x,C)}E.lineTo(v,b);var I=new THREE.ShapeGeometry(E);I.name="polyGeometry";var w=new THREE.Mesh(I,h);w.name="polyMesh",o.add(w);break;case box2d.b2ShapeType.e_edgeShape:var _=new THREE.Geometry,g=a.GetShape(),D=e.MakeInfo.mult30(g.m_vertex1.x),A=e.MakeInfo.mult30(g.m_vertex1.y),R=e.MakeInfo.mult30(g.m_vertex2.x),M=e.MakeInfo.mult30(g.m_vertex2.y);_.vertices.push(new THREE.Vector3(D,A,0)),_.vertices.push(new THREE.Vector3(R,M,0));var S=new THREE.Line(_,d);S.name="edgeLine",o.add(S)}a=a.GetNext()}var B=e.MakeInfo.mult30(i.b2body.GetLocalCenter().x),N=e.MakeInfo.mult30(i.b2body.GetLocalCenter().y),L=new THREE.Geometry;L.vertices.push(new THREE.Vector3(B,N,0),new THREE.Vector3(B+8,N,0));var S=new THREE.Line(L,this.colorClass.getLineCenterXMat());S.name="centerLineX",n.add(S),L=new THREE.Geometry,L.vertices.push(new THREE.Vector3(B,N,0),new THREE.Vector3(B,N+8,0));var S=new THREE.Line(L,this.colorClass.getLineCenterYMat());S.name="centerLineY",n.add(S);var P=t.getBoundary(!0,!0);L=new THREE.Geometry,L.vertices.push(new THREE.Vector3(P.x,P.y,0),new THREE.Vector3(P.x+P.w,P.y,0),new THREE.Vector3(P.x+P.w,P.y+P.h,0),new THREE.Vector3(P.x,P.y+P.h,0),new THREE.Vector3(P.x,P.y,0));var S=new THREE.Line(L,this.colorClass.getLineBoundary(),THREE.LineStrip);S.name="boundaryLine",L.computeLineDistances(),s.add(S),this.itemDisplayUpdate(r,i)},i.prototype.onItemRemove=function(e){if(e.display&&e.display.three){var t=e.display.three;this.disposeShape(t,0),this.container.remove(t),delete e.display.three}},i.prototype.itemDisplayUpdate=function(t,i){t.position.set(i.ix,i.iy,0),t.getObjectByName("shape").rotation.set(0,0,i.ir),t.getObjectByName("shape").visible=this.hasDrawType(e.BaseRenderer.DRAW_SHAPE),t.getObjectByName("center").visible=this.hasDrawType(e.BaseRenderer.DRAW_CENTER),t.getObjectByName("boundary").visible=this.hasDrawType(e.BaseRenderer.DRAW_BOUNDARY);var r=i.getBoundary(!0,!0),o=t.getObjectByName("boundary").getObjectByName("boundaryLine"),n=o.geometry;n.vertices[0].set(r.x,r.y,0),n.vertices[1].set(r.x+r.w,r.y,0),n.vertices[2].set(r.x+r.w,r.y+r.h,0),n.vertices[3].set(r.x,r.y+r.h,0),n.vertices[4].set(r.x,r.y,0),n.verticesNeedUpdate=!0},i.prototype.getXYFromCamera=function(e,t){var i=new THREE.Vector3;i.set(e/this.options.width*2-1,2*-(t/this.options.height)+1,.5),i.unproject(this.camera);var r=i.sub(this.camera.position).normalize(),o=-this.camera.position.z/r.z,n=this.camera.position.clone().add(r.multiplyScalar(o));return this.options.invertY&&(n.y*=-1),n},i.prototype.disposeShape=function(e,t){if(e.geometry&&(e.geometry.dispose(),e.geometry=void 0),e instanceof THREE.Object3D){t++;for(var i=0;i<e.children.length;i++)this.disposeShape(e.children[i],t)}},i}(e.BaseRenderer);e.ThreeRenderer=t}(box2dp||(box2dp={}));